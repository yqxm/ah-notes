# 内部类

内部类不只是一种隐藏机制，它可以和周围的类进行通信。

## 创建

直接在类的内部创建。可以控制它的可见性。

除了在外部类的非静态方法，任何其他地方要创建一个内部类的对象都需要`.`出来。即`Outer.Inner`。

## 和外部类的连接

内部类可以直接访问外部类的所有字段。

## 使用`.this`和`.new`

使用外部类的名字再`.this`可以获得外部对象的引用，即`Outer.this`。

使用外部对象的引用再`.new`可以创建那个对象的内部类的对象，即`outer.new Inner()`。

在没有外部类对象的情况下是不能创建内部类对象的，因为内部类对象要和外部类对象进行沟通。除非内部类是静态的。

## 内部类的向上转型

内部类实现接口，内部类的实现就可以被隐藏。客户端就只能调用接口提供的公共方法

## 方法和作用域中的内部类

### 方法中创建内部类

方法中创建的内部类不能在方法外被访问。但这并不意味着方法内创建的内部类对象出了方法后就无效了。

### 作用域中创建内部类

例如，在`if`语句中创建作用域。

### 匿名内部类

这种语法创建了一个继承接口或类的匿名类的对象。

```java
Contents c = new Contents() {
    private int i = 11;
    @Override 
    public int value() { 
        return i; 
    }
};

Wrapping w = new Wrapping(x) {
    @Override
    public int value() {
        return x*7;
    }
}
```

匿名内部类中使用的外围数据需要是`final`或者“创建后不会改变”的。

## static 内部类

- 不需要创建外部类对象来创建内部类的对象
- 不能访问外部类对象的非静态字段

和普通内部类的区别在于：普通内部类是不能有`static`字段，方法或者内部类的，但`static`内部类可以。

### 接口中的内部类

内部类可以作为接口的一部分，它默认是`public`和`static`的。

## 为什么使用内部类？

一般情况下想要创建一个接口的引用，让类去实现那个接口就可以了。但有时你需要处理多个接口。这时候每一个内部类都可以独立的继承一个接口或者实现，更方便的操作外部类的数据。

内部类提供了以下特性：

- 内部类可以有多个实例，每个实例有自己独立的状态信息。独立于外部类的信息。
- 一个外部类可以有多个内部类，每个内部类可以不同的继承或实现同一个类或接口
- 内部类对象的创建不和外部类对象的创建绑定。
- 没有令人迷惑的`is-a`关系，它是一个独立的个体。

## 闭包和回调

闭包：保存了创建它的作用域信息的可调用的对象。内部类就像是一个闭包。

例子：[Callbacks](https://github.com/BruceEckel/OnJava8-Examples/blob/master/innerclasses/Callbacks.java)
