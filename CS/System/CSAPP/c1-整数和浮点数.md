# 整数和浮点数的表示

## 整数的表示和处理

### 无符号编码

公式：

$$
B2U_w(\vec x)\doteq\sum_{i=0}^{w-1}x_i2^i
$$

- $B$代表二进制表示，$U$代表无符号编码，$B2U$ 表示二进制转为无符号

- $w$ 代表位数

- $x_i$ 表示第 $i$ 位上的值

### 补码

公式：

$$
B2T_w(\vec x)\doteq-x_{w-1}2^{w-1}+\sum_{i=0}^{w-2}x_i2^i
$$

- $T$ 代表补码编码

#### 无符号编码和补码的相互转换

##### 无符号转补码

$TMax$表示补码下的最大值
$$
U2T_w(u) =
\begin{cases}
u\ ,  \qquad u \leq TMax_w \\
u-2^w\ ,\quad u > TMax_w
\end{cases}
$$

##### 补码转无符号

$$
T2U_w(x) =
\begin{cases}
x\ + \ 2^w,\quad x < 0 \\
x, \quad x \geq 0
\end{cases}
$$

### 整数的运算

数学上的运算没有限制，但在计算机上的运算会有溢出,溢出的需要截掉，对剩下的位进行编码

#### 加法

##### 无符号加法

$$
x+^u_wy=
\begin{cases}
x+y,\quad x+y<2^w \\
x+y -2^w, \quad 2^w \leq x+y < 2^{w+1}
\end{cases}
$$

##### 补码加法

$$
x+^t_wy =
\begin{cases}
x+y-2^w, \quad 2^{w-1} \leq x+y \\
x+y, \quad -2^{w-1} \leq x+y \leq 2^{w-1} \\
x+y + 2^w, \quad x < -2^{w-1}
\end{cases}
$$

##### 补码的非

$$
-^t_wx=
\begin{cases}
Tmin, \quad x=Tmin_w \\
-x, \quad x > Tmin_w
\end{cases}
$$

补码中一个数和它的非相加等于0。观察发现 $Tmin$ 的非就是它本身，其他数 $x$ 的非为 $-x$

#### 乘法

##### 无符号乘法

$$
x *^u_wy=(x \cdot y)\ mod \ 2^w
$$

##### 补码乘法

补码乘法和无符号乘法在位级上是一样的。所以可以以无符号的形式计算，再将结果转为补码。
$$
x *^t_wy = U2T_w((x\cdot y)\ mod \ 2^w)
$$
在大多数机器上整数乘法指令都相当慢。所以编译器对乘法进行了优化，用移位和加法运算的组合来代替常数因子的乘法。比如 $x*14$就可以重写为 $(x<<3)+(x<<2)+(x<<1)$。不过这种方法不能推广到除法。

#### 除法

##### 除以2的幂的优化

整数除法需要舍入到0。对无符号编码来说直接进行逻辑右移就行，而对补码来说需要使用算数右移来保证符号位，使用偏置量来保证向0舍入。

当$x<0$时
$$
(x+(1<<k)-1)>>k
$$
产生向上舍入的值。

这里利用了下面这个属性$x/y$的向上舍入**等于** $(x+y-1)/y$的向下舍入。理解这个属性可以假设$x = qy + r$。当$r = 0$时，结果为$q$。当$r > 0$时，结果为$q+1$。

## 浮点数的表示

### 浮点数的编码方式

浮点表示对形如$V=x \times 2^y$ 的有理数进行编码。

#### IEEE浮点表示

IEEE标准用 $V = (-1)^s \times M \times 2^E$ 来表示一个数。

其中：

- $S$表示符号位
- $M$表示一个二进制小数
- $E$表示阶数

将浮点数的位表示划分位3个字段来对上面这些值进行编码:

- 一个单独的符号位 $s$来表示$S$
- $k$ 位的阶码字段 $exp = e_{k-1}e_{k-2}\cdots e_1e_0$来编码阶码$E$
- $n$ 位的小数字段来表示 $frac = f_{n-1}f_{n-2}\cdots f_1f_0$ 来编码$M$

单精度浮点格式中有 $k=8$, $n=23$, 加上符号位一共32位

双精度浮点格式中有 $k=11$, $n=52$，加上符号位一共64位

给定位表示，根据 $exp$ 的值，编码可以分为3种情况

##### 情况1: 规格化的值

当 $exp$ 的位模式既不全为0也不全为1时。在这种情况下，阶码字段被解释为以偏置形式表示的有符号整数，也就是说阶码的值 $E=e-Bias$ 其中 $e$ 是无符号数，$Bias$ 是一个等价于 $2^{k-1}-1$ 的偏置量。

小数字段被解释为描述小数值 $f$ ,其中 $0 \leq f < 1$ ,其二进制表示位 $0.f_{n-1}\cdots f_1f_0$ 。$M$ 被定义为 $M=1+f$ 。因为可以调整阶码 $E$ , 保证 $M$ 在1到2之间，我们就获得了一个精度位，1不用显式地表示。

##### 情况2:非规格化的值

当阶码域全位0时，所表示的数就是非规格化形式。在这种情况下，阶码值是 $E=1-Bias$ ,而尾数的值是 $M=f$ ,也就是小数字段的值，不包含开头的1。

非规格化有两个用途。首先，它提供了一个表示0的方法，因为规格化的数总是大于1的。另一个功能是表示非常接近0的数。

##### 情况3:特殊值

当阶码全为1，小数域全为0表示无穷，符号位表示正或负。

当阶码全为1，小数域为其他数是，结果为 $NaN$ ,表示不是一个数。
